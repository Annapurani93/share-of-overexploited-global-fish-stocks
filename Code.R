library(tidytuesdayR)
library(tidyverse)
library(reshape2)
tuesdata <- tidytuesdayR::tt_load('2021-10-12')

tuesdata$`fish-stocks-within-sustainable-levels`->sustainable
glimpse(sustainable)
summary(sustainable)

data.frame(sustainable)%>%
  filter(str_detect(Entity,"World"))%>%
  distinct(Year,.keep_all = TRUE)%>%
  select(-Code)->sustain

sustain[c(2,3,4)]->sustain
colnames(sustain)<-c("Year","Sustainable","Overexploited")
sustain
melt(sustain,id.vars = "Year",measure.vars = c("Sustainable","Overexploited"),
     value.name = "Value")->m1
colnames(m1)<-c("Year","Category","Percentage")
hsize=2
m1%>% 
  mutate(x = hsize)

ggplot(m1, aes(x = hsize, y = Percentage, fill = Category)) +
  geom_col(color="white") +
  coord_polar(theta = "y")+
  geom_text(aes(label = paste0(round(Percentage),"%")),
            size=3,
            fontface="bold",
            position = position_stack(vjust = 0.5))+
  xlim(c(0.2, hsize+0.5))+
  facet_wrap(~Year,ncol = 7)+
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.line = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank())+
  theme(legend.background = element_rect(fill = "black"),
        legend.position = "top",
        legend.title = element_blank(),
        legend.text = element_text(colour = "white",face="bold"),
        plot.background = element_rect(fill = "black"),
        panel.background = element_rect(fill = "black"),
        strip.background = element_rect(fill = "black"),
        strip.text = element_text(colour = "white"))+
  scale_fill_manual(values = c("#7bc043", "#f73225"),labels = c("Biologically Sustainable", "Overexploited"))+
  labs(title = "OVER ONE-THIRD OF GLOBAL FISH STOCKS ARE OVEREXPLOITED",
       subtitle = str_wrap("A key concern for the sustainability of global patterns of seafood consumption has been the overexploitation of wild fish stocks. Overexploited essentially means that if the amount of wild fish we catch exceeds the rate at which fish can reproduce and replenish, populations will decline over time.
 In the below visualization, we can see that the share of biologically sustainable fish stocks has tumbled from 90% in 1974 to 66% in 2017, and the share of overexploited global fish stocks has surged to over 30%. However, the pace of overexploitation has fallen in the last couple of decades - most of the decline in sustainable fish populations occurred through the 1970s and 1980s.",150),
       caption="Data from Our World in Data|Design and analysis: @annapurani93")+
  theme(plot.title = element_text(colour = "white",face="bold",size=21, hjust=0.5),
        plot.subtitle = element_text(colour = "white",size=11,face="italic",hjust=0.5),
        plot.caption = element_text(colour = "white",size=8))->p

ggsave("fish.png",p,width = 12,height=8,dpi=500)
